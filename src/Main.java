import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeParseException;
import java.util.ArrayList;
import java.util.Scanner;

public class Main {
    Tr√¶ner crawlTr√¶ner; // NY LINJE
    Tr√¶ner brystsv√∏mningTr√¶ner; // NY LINJE
    Tr√¶ner butterflyTr√¶ner; // NY LINJE
    Scanner scanner = new Scanner(System.in);
    private ArrayList<Medlem> medlemmer = new ArrayList<>();
    private ArrayList<Medlem> medlemmerSomHarBetalt = new ArrayList<>();
    private ArrayList<Medlem> medlemmerSomErIRestance = new ArrayList<>();
    private ArrayList<Konkurrencesv√∏mmer> konkurrenter = new ArrayList<>();
    private ArrayList<St√¶vne> st√¶vner = new ArrayList<>();
    Filer filer = new Filer();

    public static void main(String[] args) {
        new Main().run();
    }

    private void run() {
        boolean k√∏rProgram = true;
        Menu menu = new Menu("** Menu **", "V√¶lg en mulighed:", new String[]{
                "1. Formand",
                "2. Tr√¶ner",
                "3. Kass√©r"
        });

        while (k√∏rProgram) {
            menu.printMenu();
            int brugervalg = menu.brugerensValg();

            switch (brugervalg) {
                case 1:
                    boolean k√∏rProgram1 = true;
                    Menu formandMenu = new Menu("** FORMAND **", "V√¶lg en mulighed: ", new String[]{
                            "1. Opret medlem",
                            "2. Se medlemmer",
                            "3. G√• tilbage til hoved-menuen"
                    });

                    while (k√∏rProgram1) {
                        formandMenu.printMenu();
                        int brugervalg1 = formandMenu.brugerensValg();
                        switch (brugervalg1) {
                            case 1:
                                opretMedlem();
                                break;
                            case 2:
                                tjekListe();
                                break;
                            case 3:
                                k√∏rProgram1 = false;
                                break;
                        }
                    }
                    break;
                case 2:
                    boolean k√∏rProgram2 = true;
                    Menu tr√¶nerMenu = new Menu("** TR√ÜNER **", "V√¶lg en mulighed: ", new String[]{
                            "1. Opret en konkurrencesv√∏mmers st√¶vne",
                            "2. hallooo",
                            "3. G√• tilbage til hoved-menuen"
                    });

                    while (k√∏rProgram2) {
                        tr√¶nerMenu.printMenu();
                        int brugervalg2 = tr√¶nerMenu.brugerensValg();
                        switch (brugervalg2) {
                            case 1:
                                opretSt√¶vneTilEnKonkurrencesv√∏mmer();
                                break;
                            case 2:
                            case 3:
                                k√∏rProgram2 = false;
                        }
                    }
                    break;
                case 3:
                    boolean k√∏rProgram3 = true;
                    Menu kasserMenu = new Menu("** KASSER **", "V√¶lg en mulighed: ", new String[]{
                            "1. Oversigt over medlemmer som har betalt kontingent",
                            "2. Oversigt over medlemmer som er i restance.",
                            "3. G√• tilbage til hoved-menuen"
                    });

                    while (k√∏rProgram3) {
                        kasserMenu.printMenu();
                        int brugervalg3 = kasserMenu.brugerensValg();
                        switch (brugervalg3) {
                            case 1:
                                printListeOverMedlemmerSomHarBetaltKontingent();
                            case 2:
                                printListeOverMedlemmerSomErIRestance();
                            case 3:
                                k√∏rProgram3 = false;
                        }
                    }
                    break;
                default:
                    System.out.println("Dette er ikke en mulighed. Pr√∏v igen üôÇ");

            }
        }
    }

    private void tjekListe() {
        for (int i = 0; i < medlemmer.size(); i++) {
            System.out.println(medlemmer.get(i));
        }
    }

    public void hvilkenTr√¶nerSkalMedlemmetHave(Konkurrencesv√∏mmer medlem) { // NY METODE
        if (medlem.getSv√∏mmedisciplin().equalsIgnoreCase("crawl")) {
            medlem.setTr√¶ner(crawlTr√¶ner);
        }
        if (medlem.getSv√∏mmedisciplin().equalsIgnoreCase("brystsv√∏mning")) {
            medlem.setTr√¶ner(brystsv√∏mningTr√¶ner);
        }
        if (medlem.getSv√∏mmedisciplin().equalsIgnoreCase("butterfly")) {
            medlem.setTr√¶ner(butterflyTr√¶ner);
        }
    }

    public void opretTr√¶nere() { // NY MEOTDE
        crawlTr√¶ner = new Tr√¶ner("Jamie");
        brystsv√∏mningTr√¶ner = new Tr√¶ner("The Rock");
        butterflyTr√¶ner = new Tr√¶ner("David Hasselhoff");
    }

    public void opretSt√¶vneTilEnKonkurrencesv√∏mmer() {
        System.out.println("* OPRET ST√ÜVNE *");
        System.out.println("Indtast det medlem der har v√¶ret til st√¶vne's fulde navn: ");
        String fuldeNavn = scanner.nextLine();

        Konkurrencesv√∏mmer konkurrencesv√∏mmer = findMedlemUdFraFuldtNavn(fuldeNavn);

        if (konkurrencesv√∏mmer == null) {
            System.out.println("Konkurrenten med navnet " + fuldeNavn + " kan ikke findes blandt medlemmer.");
            return;
        }

        System.out.println("Indtast st√¶vne-navn: ");
        String st√¶vneNavn = scanner.nextLine();

        System.out.println("Indtast tid: (mm,ss)");
        double tid = scanner.nextDouble();
        scanner.nextLine();

        System.out.println("Indtast din placering: ");
        int placering = scanner.nextInt();
        scanner.nextLine();

        St√¶vne nytSt√¶vne = new St√¶vne(st√¶vneNavn, tid, placering);
        konkurrencesv√∏mmer.tilf√∏jSt√¶vne(nytSt√¶vne);

        System.out.println("St√¶vne tilf√∏jet til medlemmet: " + fuldeNavn + "\n" + nytSt√¶vne);
        // TODO lav fil som gemmer st√¶vne
    }

    private Konkurrencesv√∏mmer findMedlemUdFraFuldtNavn(String fuldeNavn) {
        for (Medlem medlem : medlemmer) {
            System.out.println("Sammenligner:" + medlem.getNavn() + " med " + fuldeNavn);
            if (medlem instanceof Konkurrencesv√∏mmer && medlem.getNavn().equalsIgnoreCase(fuldeNavn)) {
                System.out.println("Medlem fundet!");
                return (Konkurrencesv√∏mmer) medlem;
            }
        }
        System.out.println("Medlem ikke fundet.");
        return null;
    }

    public void opretMedlem() {
        System.out.println("* OPRET NYT MEDLEM *");
        System.out.println("Indtast fulde navn:");
        String navn = scanner.nextLine();

        System.out.println("Indtast f√∏dsels√•r: (YYYY)");
        int f√∏dsels√•r = scanner.nextInt();
        scanner.nextLine(); // Ryd buffer efter at have l√¶st et tal

        String aktivEllerPassivSomOrd = aktivEllerPassivSomOrd(); // Sp√∏rg kun √©n gang
        String erKontingentBetaltSomOrd = erKontingentBetaltSomOrd();
        String motionistEllerKonkurrenceSomOrd = motionistEllerKonkurrenceSomOrd(); // Sp√∏rg kun √©n gang

        Medlem nytMedlem = new Medlem(navn, f√∏dsels√•r, aktivEllerPassivSomOrd, erKontingentBetaltSomOrd, motionistEllerKonkurrenceSomOrd);
        // nytMedlem.setErKontingentBetalt(erKontingentBetaltSomOrd(nytMedlem)); // NY LINJE
        // hvilkenKontingentListe(nytMedlem);

        if (nytMedlem.getMotionistEllerKonkurrence().equalsIgnoreCase("konkurrence")) {
            opretKonkurrenceSv√∏mmer(nytMedlem);
        } else {
            medlemmer.add(nytMedlem);
            System.out.println("Medlem oprettet: " + nytMedlem);
            filer.gemFileMotionist(nytMedlem);
        }
    }

    public void opretKonkurrenceSv√∏mmer(Medlem nytMedlem) {
        opretTr√¶nere();
        System.out.println("Du er nu i gang med at oprette en konkurrence sv√∏mmer!");
        String sv√∏mmeDisciplinSomOrd = sv√∏mmeDisciplinSomOrd();
        System.out.println("Har medlemmet en bedste tid? (ja/nej)");
        String jaEllerNej = scanner.nextLine();
        if (jaEllerNej.equalsIgnoreCase("ja")) {
            System.out.println("Hvad er medlemmets bedste tid? (mm,ss)");
            double bedsteTid = scanner.nextDouble();
            scanner.nextLine(); // Ryd scannerens buffer
            System.out.println("Hvilken dato havde medlemmet sin bedste tid? (format: dd-MM-yyyy)");
            String datoStr = scanner.nextLine();
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("dd-MM-yyyy");
            LocalDate dato = null;
            try {
                dato = LocalDate.parse(datoStr, formatter);
            } catch (DateTimeParseException e) {
                System.out.println("Ugyldigt datoformat. Pr√∏v igen.");
                opretKonkurrenceSv√∏mmer(nytMedlem);
            }

            Konkurrencesv√∏mmer konkurrencesv√∏mmer = new Konkurrencesv√∏mmer(nytMedlem.getNavn(), nytMedlem.getF√∏dsels√•r(), nytMedlem.getAktivEllerPassiv(),
                    nytMedlem.getErKontingentBetalt(), nytMedlem.getMotionistEllerKonkurrence(),
                    sv√∏mmeDisciplinSomOrd, bedsteTid, dato);
            hvilkenTr√¶nerSkalMedlemmetHave(konkurrencesv√∏mmer); // NY LINJE
            medlemmer.add(konkurrencesv√∏mmer);
            System.out.println("Medlem oprettet: " + konkurrencesv√∏mmer);
            filer.gemFileKonkurrenter(konkurrencesv√∏mmer);
        }
        else {
            double bedsteTid = 0;
            LocalDate dato = null;
            Konkurrencesv√∏mmer konkurrencesv√∏mmer = new Konkurrencesv√∏mmer(nytMedlem.getNavn(), nytMedlem.getF√∏dsels√•r(), nytMedlem.getAktivEllerPassiv(), nytMedlem.getErKontingentBetalt(),
                    nytMedlem.getMotionistEllerKonkurrence(),
                    sv√∏mmeDisciplinSomOrd, bedsteTid, dato);
            hvilkenTr√¶nerSkalMedlemmetHave(konkurrencesv√∏mmer); // NY LINJE
            // medlemmer.add(konkurrencesv√∏mmer);
            System.out.println("Medlem oprettet: " + konkurrencesv√∏mmer);
            filer.gemFileKonkurrenter(konkurrencesv√∏mmer);
            medlemmer.add(konkurrencesv√∏mmer); // DET HAR EMILIA SAT IND - SKAL LIGE SE OM DET VIRKER, VI KAN SNAKKE OM OM DET SKAL BLIVE ELLER EJ
        }


    }
    public String aktivEllerPassivSomOrd() {
        while (true) {
            System.out.println("Indtast aktivitetsform: (Hvis aktiv tast 'A' / Hvis passiv tast 'P')");
            String aEllerP = scanner.nextLine();

            if (aEllerP.equalsIgnoreCase("a")) {
                return "Aktiv";
            } else if (aEllerP.equalsIgnoreCase("p")) {
                return "Passiv";
            } else {
                System.out.println("Ugyldigt bogstav. Pr√∏v igen.");
            }
        }
    }

    public String erKontingentBetaltSomOrd() {
        while (true) {
            System.out.println("Vil medlemmet betale nu eller senere? Tast 'n' for nu. Tast 's' for senere.");
            String nEllerS = scanner.nextLine();
            if (nEllerS.equalsIgnoreCase("n")) {
                LocalDate dato = LocalDate.now();
                DateTimeFormatter formatter = DateTimeFormatter.ofPattern("dd-MM-yyyy");
                String formattedDato = dato.format(formatter);
                return "Kontingent betalt " + formattedDato; //TODO Bel√∏b p√• s√• vi kan se pris
            }
            else if (nEllerS.equalsIgnoreCase("s")) {
                return "RESTANCE";
            }
            else {
                System.out.println("Ugyldigt bogstav. Pr√∏v igen.");
            }
        }
    }

    public String erKontingentBetaltSomOrd(Medlem medlem) {
        if (medlem.getErKontingentBetalt().equalsIgnoreCase("Kontingent betalt")) {
            LocalDate dato = LocalDate.now();
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("dd-MM-yyyy");
            String formattedDato = dato.format(formatter);
            Betaling betaling = new Betaling();
            double medlemsPris = betaling.udregnPris(medlem);
            String medlemsPrisSomString = String.valueOf(medlemsPris);
            return "Medlemskab p√•: " +medlemsPrisSomString +"kr. er betalt" + formattedDato;
        }
        return "";
    }

    public String kontigentRestance(Medlem medlem) {
        Betaling betaling = new Betaling();
        double restance = betaling.udregnPris(medlem);

        String restanceSomString = String.valueOf(restance);
        return "Restance p√•: " + restanceSomString; //TODO Bel√∏b p√• s√• vi kan se pris
    }


    public String motionistEllerKonkurrenceSomOrd() {
        while (true) {
            System.out.println("Indtast aktivitetstype: (Hvis motionist tast 'M' / Hvis konkurrencesv√∏mmer tast 'K')");
            String mEllerK = scanner.nextLine();

            if (mEllerK.equalsIgnoreCase("m")) {
                return "Motionist";
            } else if (mEllerK.equalsIgnoreCase("k")) {
                return "Konkurrence";
            } else {
                System.out.println("Ugyldigt bogstav. Pr√∏v igen.");
            }
        }
    }


    public String sv√∏mmeDisciplinSomOrd() {
        while (true) {
            System.out.println("Indtast hvilken sv√∏mmedisciplin medlemmet skal registreres i: ('c' for Crawl. 'b' for Brystsv√∏mning. 'bf' for Butterfly)");
            String bogstav = scanner.nextLine();

            if (bogstav.equalsIgnoreCase("c")) {
                return "Crawl";
            } else if (bogstav.equalsIgnoreCase("b")) {
                return "Brystsv√∏mning";
            } else if (bogstav.equalsIgnoreCase("bf")) {
                return "Butterfly";
            } else {
                System.out.println("Ugyldigt bogstav. Pr√∏v igen.");
            }
        }
    }

    public void printListeOverMedlemmerSomHarBetaltKontingent() {
        filer.l√¶sFileMotionisterBetalt();
        filer.l√¶sFileKonkurrenterBetalt();
    }

    public void printListeOverMedlemmerSomErIRestance() {
        filer.l√¶sFileMotionisterIRestance();
        filer.l√¶sFileKonkurrenterIRestance();
    }
}